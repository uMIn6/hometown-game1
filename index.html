<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>希望旅程</title>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --panel:#111827ee;   /* gray-900/93 */
      --card:#0b1222;      /* dark card */
      --muted:#9ca3af;     /* gray-400 */
      --acc:#22c55e;       /* green-500 */
      --acc-2:#38bdf8;     /* sky-400 */
      --warn:#f59e0b;      /* amber-500 */
      --danger:#ef4444;    /* red-500 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, #1e293b 0%, #0b1020 45%, var(--bg) 100%);
      color:#e5e7eb; overflow:hidden;
    }
    .app{display:grid; grid-template-columns: 320px 1fr 360px; gap:16px; height:100%; padding:16px}
    @media (max-width: 1100px){.app{grid-template-columns:1fr; grid-template-rows:auto auto 1fr; overflow:auto}}
    .panel{background:linear-gradient(180deg, #0c1428 0%, #0a0f1d 100%); border:1px solid #1f2a44; border-radius:16px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 6px; font-size:22px; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:12px}
    .row{display:flex; gap:8px; align-items:center}
    .stack{display:flex; flex-direction:column; gap:8px}
    .kpi{display:grid; grid-template-columns:repeat(2,1fr); gap:8px}
    .kpi .card{background:var(--card); border:1px solid #1e293b; border-radius:12px; padding:10px}
    .kpi .label{font-size:12px; color:var(--muted)}
    .kpi .val{font-weight:700; font-size:20px}
    .money{font-size:28px; font-weight:800}
    .pill{padding:4px 8px; background:#0f172a; border:1px solid #1f2a44; border-radius:999px; font-size:12px; color:var(--muted)}
    .btn{cursor:pointer; background:linear-gradient(180deg, #12325a 0%, #0d2545 100%); border:1px solid #1e3a5f; border-radius:12px; padding:10px 12px; color:#e5e7eb; font-weight:600}
    .btn:hover{filter:brightness(1.1)}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .btn-acc{background:linear-gradient(180deg, #1f9e54 0%, #157d3f 100%); border-color:#1a7a45}
    .btn-warn{background:linear-gradient(180deg, #b97709 0%, #946107 100%); border-color:#9a6b09}
    .btn-ghost{background:#0a1222; border-color:#1f2a44}

    .progress{height:8px; background:#0b1222; border-radius:999px; overflow:hidden; border:1px solid #1f2a44}
    .bar{height:100%; background:linear-gradient(90deg, var(--acc), var(--acc-2)); width:0%}

    .cards{display:flex; flex-direction:column; gap:12px; overflow:auto; height:calc(100% - 40px); padding-right:4px}
    .card{background:linear-gradient(180deg, #0f1a32 0%, #0b1222 100%); border:1px solid #1f2a44; border-radius:16px; padding:14px}
    .card h3{margin:0 0 6px}
    .muted{color:var(--muted)}
    .right .project{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center}
    .tag{font-size:11px; padding:2px 6px; border-radius:999px; border:1px solid #1f2a44; color:#cbd5e1; background:#0b1222}
    .statrow{display:grid; grid-template-columns:1fr 1fr; gap:6px}
    .meter{height:8px; background:#0b1222; border:1px solid #1f2a44; border-radius:8px; overflow:hidden}
    .meter > span{display:block; height:100%; background:linear-gradient(90deg, #60a5fa, #34d399); width:50%}

    .sticky-footer{position:sticky; bottom:0; background:linear-gradient(180deg, #0b1222cc, #0b1222); border-top:1px solid #1f2a44; margin-top:8px; padding:12px; border-radius:14px}
    .foot-grid{display:grid; grid-template-columns:1fr auto auto; gap:8px; align-items:center}

    .mini{font-size:12px}
  </style>
</head>
<body>
  <div class="app">
    <!-- 左：總覽 -->
    <aside class="panel stack">
      <div>
        <h1>🏡 希望旅程</h1>
        <div class="sub">塞內加爾球星 Sadio Mané 的人生故事感動了我，我也希望有機會可以讓許多人經歷到這樣的見證 ~在球場外，為家鄉創造長久的改變。</div>
      </div>

      <div class="kpi">
        <div class="card">
          <div class="label">可用資金</div>
          <div class="money" id="money">$0</div>
        </div>
        <div class="card">
          <div class="label">月份／週期</div>
          <div class="val"><span id="month">1</span> / <span id="year">1</span>年</div>
        </div>
        <div class="card">
          <div class="label">月收入（職涯）</div>
          <div class="val" id="income">$0</div>
        </div>
        <div class="card">
          <div class="label">社群信任</div>
          <div class="val" id="trust">50</div>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="label">再前進一點</div>
            <div class="progress" aria-label="影響力進度">
              <div class="bar" id="impactBar"></div>
            </div>
          </div>
          <div class="pill" id="impactScore">0 分</div>
        </div>
      </div>

      <div class="card">
        <div class="label">我們所看見的需要</div>
        <div class="statrow">
          <div>
            教育
            <div class="meter"><span id="eduMeter" style="width:20%"></span></div>
          </div>
          <div>
            醫療
            <div class="meter"><span id="healthMeter" style="width:20%"></span></div>
          </div>
          <div>
            用水
            <div class="meter"><span id="waterMeter" style="width:20%"></span></div>
          </div>
          <div>
            就業
            <div class="meter"><span id="jobsMeter" style="width:20%"></span></div>
          </div>
          <div>
            體育
            <div class="meter"><span id="sportsMeter" style="width:20%"></span></div>
          </div>
          <div>
            運行
            <div class="meter"><span id="maintMeter" style="width:50%"></span></div>
          </div>
        </div>
      </div>

      <div class="row">
        <button class="btn btn-ghost" id="saveBtn">💾 休息一下</button>
        <button class="btn btn-ghost" id="loadBtn">📂 載入</button>
        <button class="btn btn-warn" id="resetBtn">🗑️ 遊戲可重來</button>
      </div>
    </aside>

    <!-- 中：情境 / 事件卡 -->
    <main class="panel">
      <div class="row" style="justify-content:space-between; align-items:flex-end">
        <div>
          <h1>📜 本月事件</h1>
          <div class="sub">根據事件做抉擇，平衡長短期影響與財務。</div>
        </div>
        <div class="pill" id="villageTag">🏘️ 家鄉：未命名</div>
      </div>

      <div class="cards" id="eventList" aria-live="polite"></div>

      <div class="sticky-footer">
        <div class="foot-grid">
          <div class="mini muted">提示：每個月會自動結算運行成本與帶來的長期收益。社群信任會影響募資與志工參與。</div>
          <button class="btn" id="skipBtn">➡️ 跳到結算</button>
          <button class="btn btn-acc" id="nextBtn">✅ 結算本月</button>
        </div>
      </div>
    </main>

    <!-- 右：專案資源庫 -->
    <aside class="panel right stack">
      <div class="row" style="justify-content:space-between; align-items:flex-end">
        <div>
          <h1>🧭 專案選單</h1>
          <div class="sub">選擇要投資的在地專案（可重複建置不同地點）。</div>
        </div>
        <button class="btn" id="renameBtn">✏️ 設定家鄉名稱</button>
      </div>

      <div class="cards" id="projectList"></div>
    </aside>
  </div>

  <script>
    // 遊戲核心狀態
    const Game = {
      month: 1,
      year: 1,
      money: 120000, // 初始資金
      baseIncome: 80000, // 每月職涯收入（可想像為合約與代言）
      trust: 50, // 0-100
      metrics: { edu:20, health:20, water:20, jobs:20, sports:20, maint:50 }, // 0-100
      villageName: "未命名",
      projects: [], // 建置中的專案
      history: [], // 事件紀錄
    };

    // 專案藍圖（可自由擴充）
    const PROJECT_CATALOG = [
      {
        id:"school", name:"📚 小學翻修", cost: 90000, monthlyUpkeep: 4000,
        effects:{ edu:+8, jobs:+1, maint:-1 }, longTerm:"提升入學率與師資意願"
      },
      {
        id:"clinic", name:"🏥 基礎診療站", cost: 120000, monthlyUpkeep: 6000,
        effects:{ health:+10, jobs:+1, maint:-2 }, longTerm:"降低可避免的疾病風險"
      },
      {
        id:"well", name:"🚰 深水井與淨水", cost: 70000, monthlyUpkeep: 2000,
        effects:{ water:+12, health:+2, maint:-1 }, longTerm:"改善用水，減少取水時間"
      },
      {
        id:"academy", name:"⚽ 少年足球訓練中心", cost: 60000, monthlyUpkeep: 3000,
        effects:{ sports:+10, edu:+2, jobs:+1, maint:-1 }, longTerm:"以運動帶動向上與凝聚"
      },
      {
        id:"micro", name:"💼 微型創業基金", cost: 50000, monthlyUpkeep: 0,
        effects:{ jobs:+8, trust:+3 }, longTerm:"支持小店與家庭生計"
      },
      {
        id:"solar", name:"🔆 太陽能路燈", cost: 40000, monthlyUpkeep: 1000,
        effects:{ trust:+2, jobs:+1, maint:+1 }, longTerm:"提高夜間安全與活動"
      },
    ];

    // 隨機事件池
    const EVENTS = [
      {
        id:"press",
        text:"媒體關注你的家鄉計畫，若接受專訪可提升信任，但需贊助在地活動。",
        choices:[
          {label:"接受：贊助$10,000，信任+8", apply:s=>{s.money-=10000; s.trust=Math.min(100,s.trust+8)}},
          {label:"婉拒：無花費，信任-3", apply:s=>{s.trust=Math.max(0,s.trust-3)}}
        ]
      },
      {
        id:"flood",
        text:"暴雨造成道路受損，若立即修補可避免運行惡化。",
        choices:[
          {label:"緊急修補：花$20,000，運行+6", apply:s=>{s.money-=20000; s.metrics.maint=Math.min(100,s.metrics.maint+6)}},
          {label:"暫緩：省錢但運行-6", apply:s=>{s.metrics.maint=Math.max(0,s.metrics.maint-6)}}
        ]
      },
      {
        id:"sponsor",
        text:"品牌邀請公益聯名，若參與可增加月收入但需每月投入志工時數（降低運行壓力）。",
        choices:[
          {label:"參與：月收入+$10,000，運行+2", apply:s=>{s.baseIncome+=10000; s.metrics.maint=Math.min(100,s.metrics.maint+2)}},
          {label:"不參與：保持現狀", apply:s=>{}}
        ]
      },
      {
        id:"match",
        text:"本月賽事表現出色，獲得比賽獎金$30,000，是否全數捐入基金？",
        choices:[
          {label:"全數投入公益（+信任5）", apply:s=>{s.money+=30000; s.trust=Math.min(100,s.trust+5)}},
          {label:"保留一半（+現金15,000）", apply:s=>{s.money+=15000}},
          {label:"自行運用（無變化）", apply:s=>{}}
        ]
      },
    ];

    // 工具
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);
    const fmt = n => "$"+ n.toLocaleString();

    // 狀態渲染
    function renderState(){
      $('#money').textContent = fmt(Game.money);
      $('#income').textContent = fmt(Game.baseIncome);
      $('#month').textContent = Game.month;
      $('#year').textContent = Game.year;
      $('#trust').textContent = Game.trust;
      $('#villageTag').textContent = `🏘️ 家鄉：${Game.villageName}`;

      // 影響分數（簡化：各指標平均 + 信任加權）
      const m = Game.metrics; const avg = (m.edu+m.health+m.water+m.jobs+m.sports+m.maint)/6;
      const impact = Math.round(avg*0.7 + Game.trust*0.3);
      const bar = Math.max(0, Math.min(100, impact));
      $('#impactBar').style.width = bar + '%';
      $('#impactScore').textContent = impact + ' 分';

      // 指標條
      $('#eduMeter').style.width = m.edu+'%';
      $('#healthMeter').style.width = m.health+'%';
      $('#waterMeter').style.width = m.water+'%';
      $('#jobsMeter').style.width = m.jobs+'%';
      $('#sportsMeter').style.width = m.sports+'%';
      $('#maintMeter').style.width = m.maint+'%';
    }

    // 專案渲染
    function renderProjects(){
      const box = $('#projectList');
      box.innerHTML = '';

      PROJECT_CATALOG.forEach(p=>{
        const el = document.createElement('div');
        el.className = 'card project';
        el.innerHTML = `
          <div>
            <h3>${p.name}</h3>
            <div class="muted mini">一次成本：${fmt(p.cost)}｜每月運行：${fmt(p.monthlyUpkeep)}<br>${p.longTerm}</div>
            <div class="row" style="gap:6px; flex-wrap:wrap; margin-top:8px">
              ${Object.entries(p.effects).map(([k,v])=>`<span class="tag">${labelOf(k)} ${v>0?'+':''}${v}</span>`).join('')}
            </div>
          </div>
          <div class="stack" style="align-items:end">
            <button class="btn btn-acc" ${Game.money<p.cost?'disabled':''}>投資</button>
            <span class="pill mini">${Game.money<p.cost?'資金不足':'可建置'}</span>
          </div>
        `;
        el.querySelector('button').onclick=()=>buildProject(p);
        box.appendChild(el);
      });

      // 已建置清單
      if(Game.projects.length){
        const list = document.createElement('div');
        list.className='card';
        list.innerHTML = `<h3>已建置與運行</h3>`;
        Game.projects.forEach((proj,i)=>{
          const row = document.createElement('div');
          row.className='row';
          row.style.justifyContent='space-between';
          row.style.marginTop='6px';
          row.innerHTML = `<div class="mini">${proj.name} <span class="muted">（第${proj.builtAt.year}年${proj.builtAt.month}月）</span></div>
                           <div class="pill mini">運行：${fmt(proj.monthlyUpkeep)}</div>`;
          list.appendChild(row);
        })
        box.appendChild(list);
      }
    }

    function labelOf(k){
      return ({edu:'教育',health:'醫療',water:'用水',jobs:'就業',sports:'體育',maint:'運行',trust:'信任'})[k]||k;
    }

    function buildProject(p){
      if(Game.money < p.cost) return;
      Game.money -= p.cost;
      Game.projects.push({...p, builtAt:{year:Game.year, month:Game.month}});
      // 即時信任微增（透明度）
      Game.trust = Math.min(100, Game.trust + (p.effects.trust?Math.max(1,p.effects.trust):1));
      renderState(); renderProjects();
      toast(`已建置：${p.name}，家鄉看見了你的行動 💚`);
    }

    // 事件生成與渲染
    function drawEvents(){
      const box = $('#eventList');
      box.innerHTML = '';
      const pool = pick(EVENTS, 2 + (Math.random()>0.7?1:0));
      pool.forEach(e=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>事件：${emojiFor(e.id)} ${e.text}</h3>`;
        e.choices.forEach(c=>{
          const btn = document.createElement('button');
          btn.className='btn'; btn.textContent=c.label;
          btn.onclick=()=>{ c.apply(Game); renderState(); disableCard(card); };
          card.appendChild(btn);
          card.appendChild(document.createTextNode(' '));
        });
        box.appendChild(card);
      });
    }
    function emojiFor(id){
      return ({press:'📰', flood:'🌧️', sponsor:'🤝', match:'🥇'})[id] || '📌';
    }
    function disableCard(card){
      [...card.querySelectorAll('button')].forEach(b=>{b.disabled=true; b.classList.add('btn-ghost')});
      const note = document.createElement('div'); note.className='muted mini'; note.textContent='已選擇'; card.appendChild(document.createElement('br')); card.appendChild(note);
    }

    // 月結算
    function settleMonth(skipWarnings=false){
      // 收入
      Game.money += Game.baseIncome;
      // 專案運行成本
      const upkeep = Game.projects.reduce((a,p)=>a+p.monthlyUpkeep,0);
      Game.money -= upkeep;
      // 長期效果疊加
      Game.projects.forEach(p=>{
        for(const [k,v] of Object.entries(p.effects)){
          if(k==='trust'){ Game.trust = clamp(Game.trust + v*0.2,0,100); }
          else { Game.metrics[k] = clamp(Game.metrics[k] + v*0.5, 0, 100); }
        }
      });
      // 運行不足懲罰
      if(Game.metrics.maint < 30){
        Game.trust = Math.max(0, Game.trust - 4);
        Game.metrics.edu = Math.max(0, Game.metrics.edu - 2);
        Game.metrics.health = Math.max(0, Game.metrics.health - 2);
      }
      // 現金不足警示
      if(Game.money < 0 && !skipWarnings){
        alert('注意：現金流為負！請增加收入或減少新建專案。');
      }

      // 時間遞進
      Game.month++; if(Game.month>12){ Game.month=1; Game.year++; }
      renderState(); renderProjects(); drawEvents();
      toast('已結算本月：收入與維運已體現在指標');
      saveAuto();
    }
    function skipToSettle(){
      toast('你選擇跳過事件，直接進入結算');
      settleMonth(true);
    }

    // 儲存 / 載入
    function save(name='autosave'){
      localStorage.setItem('hometown_saver_'+name, JSON.stringify(Game));
      toast('已儲存進度');
    }
    function load(name='autosave'){
      const raw = localStorage.getItem('hometown_saver_'+name);
      if(!raw){ toast('找不到存檔'); return; }
      const data = JSON.parse(raw);
      Object.assign(Game, data);
      renderState(); renderProjects(); drawEvents();
      toast('載入成功');
    }
    const saveAuto = ()=> save('autosave');

    // 其他輔助
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
    function pick(arr, n){
      const pool = [...arr]; const out=[]; while(out.length<n && pool.length){
        const i = Math.floor(Math.random()*pool.length); out.push(pool.splice(i,1)[0]);
      } return out;
    }
    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg; t.className='pill'; t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.zIndex=50; t.style.background='#0b1222ee'; t.style.border='1px solid #1f2a44';
      document.body.appendChild(t); setTimeout(()=>t.remove(), 2200);
    }

    // 事件綁定
    $('#nextBtn').onclick = ()=> settleMonth();
    $('#skipBtn').onclick = ()=> skipToSettle();
    $('#saveBtn').onclick = ()=> save('slot1');
    $('#loadBtn').onclick = ()=> load('slot1');
    $('#resetBtn').onclick = ()=>{ if(confirm('確定要開新局嗎？目前進度將清除。')){ localStorage.removeItem('hometown_saver_slot1'); localStorage.removeItem('hometown_saver_autosave'); location.reload(); } };
    $('#renameBtn').onclick = ()=>{
      const name = prompt('請輸入你的家鄉名稱（例如：班巴利、清水村…）', Game.villageName);
      if(name){ Game.villageName = name.trim().slice(0,20); renderState(); saveAuto(); }
    };

    // 初始化
    (function init(){
      renderState(); renderProjects(); drawEvents();
      // 初始提示
      setTimeout(()=>toast('提示：先從「深水井」或「小學翻修」開始，逐步建立信任'), 600);
    })();
  </script>
</body>
</html>
